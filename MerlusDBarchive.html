<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The core Firebase JS SDK is always required and must be listed first -->
<!--<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<!--<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-analytics.js"></script>-->
<script src="https://www.gstatic.com/firebasejs/8.2.3/firebase.js"></script>

<script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyCkJTS2YR8rF2nBGflp3r4YsuSfcFoV27I",
    authDomain: "msp-db.firebaseapp.com",
    projectId: "msp-db",
    storageBucket: "msp-db.appspot.com",
    messagingSenderId: "1056691406446",
    appId: "1:1056691406446:web:ddfdc5cbdd4e6f23f1887f",
    measurementId: "G-SCJW2HFLBR",
    databaseURL:"https://msp-db-default-rtdb.firebaseio.com/"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  fdb = firebase.database().ref("pos/infeed")
  firebase.analytics();
</script>
<script src="play.js"></script>
<script>
  app = new setup({ title: "MerlusDB™" })
  app.module("hero", "slit","menu", "drawer", "underweigh", "bar")
  app.ready(start)

  function start() {
    
    if (store.mspdb) db = JSON.parse(store.mspdb);
    else db = { "BF1Boxing": [], "BF1Pulling": [] , "BF2Boxing": [], "BF2Pulling": [], "Knives": [], "Breakdown": [], "Memo": [] }
    cdb="BF1Boxing"


    b = new bar("MerlusDB")
    b.icons(0).on("click", function() { d.open() })
    b.icons(1).on("click", function() {
      new menu("Save,Reset all files,Reset current file,Settings,Exit", "right,top", function(e, h) {
        /*world menu*/
        if(h=="Save")app.prompt("Teamleader name",null,function(e){if(e){db.body=e;db.title=dater();fdb.limitToLast(1).once("child_added", function (s) {
          //fdb.child(s.key).update({tl:e})
   if(s.val().title==dater())app.confirm("Today's file has already been saved, do you want to update?","Warning",function(e){if(e){fdb.child(s.key).set(db,function(){app.alert("Successfully saved.")})}});else fdb.push(db,function(){app.alert("Successfully saved.")})
  });
}})
        if(h=="Reset current file")app.confirm("this will delete all entries entered on this file, continue?","Warning",function(e){if(e){db[cdb]=[];sdb();mlist.list([])}})
        if(h=="Reset all files")app.confirm("your about to delete all entries entered today, make sure files are saved before deleting, continue?","Warning",function(e){if(e){db = { "BF1Boxing": [], "BF1Pulling": [] , "BF2Boxing": [], "BF2Pulling": [], "Knives": [], "Breakdown": [], "Memo": [] };sdb();mlist.list([])}})
        if (h == "Settings") new menu("Hue,Theme,Font", "top,right",function(e,h){
          if(h=="Theme")new menu("light,dark,black","top,right",function(e,h){app.theme(h)})
        });
      })
    })
    d = new drawer();
    d.body.add(new hero("MerlusDB™ Infeed", "100%", "200px", "bottom,right"), dlist = new stringlist("BF1Boxing,BF1Pulling,BF2Boxing,BF2Pulling,Knives,Breakdrown,Memo").select(function(e, h, d) {
      mlist.list(db[h.title]);
      cdb=h.title
      dlist.highlight(e);
      b.label(h.title) }).css({ "padding": "15px 0px" }))
    dlist.highlight(0);
    b.label("BF1Boxing")


    u = new underweigh
    u.title.add(new button("New Entry", null, null, "pill,silent").css({ "margin-left": "auto" }).on("click", function() {
      var dat={}
        if (dlist.highlighted == 6) new dialog("Add new note", new edit("note desc...", "95%", "150px", "multi").css({ "padding": "5px" }))


/*boxing query*/
if(dlist.highlighted==0||dlist.highlighted==2){
  app.prompt("enter name",null,function(e){
    if(e){dat.title=e;app.prompt("start time",null,function(e){if(e){
      dat.st=e.replace(",",":").replace(".",":")
      if(dat.st.length==4)dat.st="0"+dat.st
      new dialog("Items missing?",l=new stringlist("yes,no").css({"padding":"10px 0px"}).select(function(e,h,d){l.highlight(e)}),function(e){
       dat.im=l.list()[l.highlighted].title
       new dialog("Knife code",l=new stringlist("I/F1,I/F2,I/F3,QC1,QC2,QC3").css({"padding":"10px 0px"}).select(function(e,h,d){l.highlight(e)}),function(e){
       dat.kc=l.list()[l.highlighted].title
       app.prompt("Mappa glove",null,function(e){
         var hr,mn=0;
         hr=dat.st.split(":")[0]-0
         mn=dat.st.split(":")[1]-0
         if(mn==30){
           hr++
           dat.et=hr+":"+"00"
           if(hr.length==1)dat.et="0"+hr+":"+"00"
         }else{
          
           dat.et=hr+":"+"30"
           if(hr.length==1)dat.et="0"+hr+":"+"30"
         }
         dat.mg=e||"n/a";dat.body=dat.st+" - "+dat.et
         db[cdb].push(dat);sdb();mlist.push(dat)
         app.snack("You're all set "+dat.title+".")
         
       })
      })
      l.highlight(1)
      })
      l.highlight(1)
    }},"number")
  }})
}
        

/*pulling query*/
        if (dlist.highlighted == 1||dlist.highlighted==3) app.prompt("enter name",null,function(e){
          if(e){dat.title=e;app.prompt("start time",null,function(e){
            if(e){dat.st=e.replace(".",":").replace(",",":");
            if(dat.st.length==4)dat.st="0"+dat.st
            app.prompt("mappa code",null,function(e){
              dat.mc=e||"n/a";dat.et="ongoing";dat.body=dat.st+" - "+dat.et
              db[cdb].push(dat);sdb();mlist.push(dat)
              app.snack("happy pullings "+dat.title+".")
            })}
          },"number,insist")}
        })
        
      
    })).css({ "padding": "10px 0px" })
    u.body.align("center").justify("center").css({ "background": "var(--back)" }).add(new text("coming soon", null, null, "accent"))



    body.add(ney = new text("No entries yet.", "95%").css({ "text-align": "center", color: "var(--accent)" }), mlist = new stringlist(db.BF1Boxing).select(function(e,h,d){new menu("View,Delete",null,function(e2,h2){
      var num=e
      if(h2=="View"){
        if(cdb.includes("Boxing")){
          new dialog(h.title,new flex("column").add(new stringlist([{title:"Start time",body:h.st},{title:"End time",body:h.et},{title:"Knife code",body:h.kc},{title:"Mappa code",body:h.mg},{title:"Mappa condition",body:h.con||"good"}])),null,null,"edit")
        }
        if(cdb.includes("Pulling")){
          new dialog(h.title,new flex("column").add(new stringlist([{title:"Start time",body:h.st},{title:"End time",body:h.et},{title:"Mappa code",body:h.mc},{title:"Mappa condition",body:h.con||"good"}])),function(e){
            if(e){
              if(h.et=="ongoing")app.prompt("end time",null,function(e){
                db[cdb][num].et=e.replace(",",":").replace(".",":")
                if(db[cdb][num].et.length==4)db[cdb][num].et="0"+db[cdb][num].et;db[cdb][num].body=db[cdb][num].st+" - "+db[cdb][num].et;sdb();mlist.list(db[cdb])
              },"number")
            }
          },null,h.et=="ongoing"?"finnish":"edit")
        }
      }
      if(h2=="Delete")app.confirm(`Are you sure to delete ${h.title}'s post?`,null,function(e3){if(e3){db[cdb][ctb()].splice(e,1);mlist.pop(e);sdb()}})})}))
    setInterval(function() { if (mlist.list().length == 0) ney.css("display", "inline");
      else ney.css("display", "none") }, 100)
  }

  function sdb() {
    store.mspdb = JSON.stringify(db)
  }
  function dater(){
    var Dat=new Date()
    var d=Dat.getDate()
    var m=Dat.getMonth()+1
    var y=Dat.getFullYear()
    return d+"_"+m+"_"+y
  }
</script>

</html>